@model MvcWebApiSwaggerApp.Models.LoginViewModel
@{
    ViewData["Title"] = "Login";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ================= CORE ANIMATIONS ================= */
        @@keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(26px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeUp .9s cubic-bezier(.16,1,.3,1) forwards;
        }

        @@keyframes stagger {
            from {
                opacity: 0;
                transform: translateY(18px);
            }

            to {
                opacity: 1;
                transform: none;
            }
        }

        .stagger > * {
            animation-fill-mode: both;
        }

        @@media (prefers-reduced-motion: reduce) {
            .stagger > * {
                opacity: 1 !important;
                transform: none !important;
                animation: none !important;
            }
        }

        .stagger > *:nth-child(1) {
            animation-delay: .05s
        }

        .stagger > *:nth-child(2) {
            animation-delay: .15s
        }

        .stagger > *:nth-child(3) {
            animation-delay: .25s
        }

        .stagger > *:nth-child(4) {
            animation-delay: .35s
        }

        .stagger > *:nth-child(5) {
            animation-delay: .45s
        }

        .stagger > *:nth-child(6) {
            animation-delay: .55s
        }

        @@keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-4px);
            }

            50% {
                transform: translateX(4px);
            }

            75% {
                transform: translateX(-4px);
            }
        }

        .shake {
            animation: shake .35s;
        }

        /* ================= iOS GLASS ================= */
        .glass-card {
            backdrop-filter: blur(26px) saturate(170%);
            -webkit-backdrop-filter: blur(26px) saturate(170%);
            background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.62));
            border: 1px solid rgba(255,255,255,.55);
            box-shadow: 0 38px 80px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.75);
        }

        /* ================= INPUT MICRO ================= */
        input {
            transition: transform .25s ease, box-shadow .25s ease;
        }

            input:focus {
                transform: translateY(-1px);
                box-shadow: 0 6px 16px rgba(99,102,241,.25);
            }

        /* ================= BUTTON ================= */
        .login-btn {
            position: relative;
            overflow: hidden;
        }

            .login-btn::after {
                content: "";
                position: absolute;
                inset: 0;
                background: linear-gradient(120deg, transparent, rgba(255,255,255,.4), transparent);
                transform: translateX(-100%);
            }

            .login-btn:hover::after {
                animation: shine 1.1s ease;
            }

        @@keyframes shine {
            to {
                transform: translateX(100%);
            }
        }

        /* ================= CARD TOAST ================= */
        @@keyframes cardToastIn {
            from {
                opacity: 0;
                transform: translateY(14px) scale(.96);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .card-toast {
            animation: cardToastIn .35s cubic-bezier(.16,1,.3,1);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
        }

        .card-toast {
            backdrop-filter: blur(22px) saturate(160%);
            -webkit-backdrop-filter: blur(22px) saturate(160%);
            border: 1px solid rgba(255,255,255,.45);
            animation: cardToastIn .35s cubic-bezier(.16,1,.3,1);
        }

        .card-toast-success {
            background: linear-gradient(135deg, rgba(99,102,241,.35), rgba(79,70,229,.25));
            box-shadow: 0 18px 45px rgba(99,102,241,.45), inset 0 1px 0 rgba(255,255,255,.5);
        }

        .card-toast-error {
            background: linear-gradient(135deg, rgba(239,68,68,.32), rgba(220,38,38,.25));
            box-shadow: 0 18px 45px rgba(239,68,68,.35), inset 0 1px 0 rgba(255,255,255,.45);
        }

        /* ================= ELECTRIC CANVAS ================= */
        canvas {
            filter: drop-shadow(0 0 8px rgba(99,102,241,.6)) drop-shadow(0 0 18px rgba(99,102,241,.35));
        }

        /* ================= LOADING SPINNER ================= */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @@keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="min-h-screen relative overflow-hidden bg-gradient-to-br from-sky-50 via-white to-indigo-100">
    <!-- Background animation canvas -->
    <canvas id="electricCanvas" class="absolute inset-0 w-full h-full z-[1] pointer-events-none"></canvas>
    <div class="absolute inset-0 bg-white/50 backdrop-blur-sm"></div>

    <div class="relative z-10 min-h-screen flex items-center justify-center px-4">
        <div class="relative w-full max-w-[360px]">
            <div class="p-7 sm:p-8 rounded-2xl fade-in glass-card">
                <div class="stagger">
                    <div class="flex flex-col items-center mb-6">
                        <img src="~/assets/images/kseblogo.png" alt="Your Logo" class="h-16 mb-3">
                        <h1 class="text-lg sm:text-xl font-medium text-gray-900 text-center">
                            Sign in to <span class="text-indigo-600">Electric City</span>
                        </h1>
                        <p class="text-xs text-gray-500 mt-1 text-center">
                            Secure access to your dashboard
                        </p>
                    </div>

                    @if (ViewBag.Error != null)
                    {
                        <div class="mb-4 p-3 rounded-lg bg-rose-600/20 border border-rose-500/30 text-rose-700 text-sm">
                            @ViewBag.Error
                        </div>
                    }

                    <!-- Login Form -->
                    <form method="post" id="loginForm">
                        @Html.AntiForgeryToken()

                        <input type="email" name="Email" required placeholder="Email Address"
                               class="w-full h-11 rounded-lg px-4 bg-white/75 border border-gray-300/60
                               placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-2" />

                        <input type="password" name="Password" required placeholder="Password"
                               class="w-full h-11 rounded-lg px-4 bg-white/75 border border-gray-300/60
                               placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />

                        <button type="submit" id="loginBtn"
                                class="w-full h-11 mt-6 rounded-lg bg-indigo-600 hover:bg-indigo-700
                                active:scale-[0.97] text-white font-semibold transition shadow-md login-btn flex items-center justify-center gap-2">
                            <span id="btnText">Login</span>
                            <div id="spinner" class="spinner hidden"></div>
                        </button>
                    </form>

                    <div class="mt-6 flex items-center justify-center gap-2 text-xs text-gray-500">
                        <span>Powered by</span>
                        <img src="~/assets/images/logo.png" class="h-9 object-contain opacity-80" />
                    </div>

                    <!-- Register Link -->
                    <div class="mt-6 text-center">
                        <p class="text-sm text-gray-500">
                            Don't have an account?
                            <a asp-controller="Register" asp-action="Create" class="text-indigo-600 hover:text-indigo-700 font-medium">
                                Register
                            </a>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Toast Notification -->
            <div id="cardToast" class="fixed bottom-6 left-0 right-0 flex justify-center px-4 hidden pointer-events-none z-50"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            const cardToast = document.getElementById('cardToast');

            // Show error toast if there's an error on page load
            const errorMessage = document.querySelector('.bg-rose-600\\/20');
            if (errorMessage && errorMessage.textContent.trim()) {
                setTimeout(() => {
                    toast(errorMessage.textContent.trim());
                }, 500);
            }

            function toast(msg, ok = false) {
                cardToast.innerHTML = "";
                cardToast.classList.remove("hidden");

                const t = document.createElement("div");
                t.className = `card-toast ${ok ? "card-toast-success" : "card-toast-error"}
                             text-base text-white px-6 py-4 rounded-2xl
                             flex items-center gap-3 min-w-[320px] max-w-[380px] justify-center`;
                t.innerHTML = `<span>${ok ? "✓" : "✗"}</span><span>${msg}</span>`;
                cardToast.appendChild(t);

                setTimeout(() => {
                    t.style.opacity = "0";
                    setTimeout(() => cardToast.classList.add("hidden"), 300);
                }, 2600);
            }

            function showLoading() {
                btnText.textContent = "Authenticating...";
                spinner.classList.remove("hidden");
                loginBtn.disabled = true;
            }

            loginForm.addEventListener('submit', function() {
                showLoading();
            });

            // Also clear loading if page reloads due to validation error
            window.addEventListener('pageshow', function(event) {
                if (event.persisted) {
                    btnText.textContent = "Login";
                    spinner.classList.add("hidden");
                    loginBtn.disabled = false;
                }
            });
        });
    </script>

    <!-- Background Animation Script -->
    <script>
        const canvas = document.getElementById("electricCanvas");
        const ctx = canvas.getContext("2d");
        let w, h;

        function resize(){
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        }

        window.addEventListener("resize", resize);
        resize();

        const isMobile = window.innerWidth < 768;
        const NODE_COUNT = isMobile ? 70 : 140;
        const MAX_DIST = isMobile ? 110 : 170;
        const SPEED = isMobile ? 0.6 : 1.1;

        const nodes = [];
        for(let i = 0; i < NODE_COUNT; i++) {
            nodes.push({
                x: Math.random() * w,
                y: Math.random() * h,
                vx: (Math.random() - 0.5) * SPEED,
                vy: (Math.random() - 0.5) * SPEED
            });
        }

        function animate() {
            ctx.clearRect(0, 0, w, h);
            for(let i = 0; i < nodes.length; i++) {
                const p = nodes[i];
                p.x += p.vx;
                p.y += p.vy;
                if(p.x < 0 || p.x > w) p.vx *= -1;
                if(p.y < 0 || p.y > h) p.vy *= -1;
                for(let j = i + 1; j < nodes.length; j++) {
                    const q = nodes[j];
                    const d = Math.hypot(p.x - q.x, p.y - q.y);
                    if(d < MAX_DIST) {
                        ctx.strokeStyle = `rgba(99,102,241,${1 - d/MAX_DIST})`;
                        ctx.lineWidth = isMobile ? 0.8 : 1.1;
                        ctx.beginPath();
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(q.x, q.y);
                        ctx.stroke();
                    }
                }
            }
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>